{% extends "layout.html" %} 
{% block body %}


<style>
  .vis{
    width: 100%;
    height: 500px;
  }

  svg {
    width: 100%;
    height: 100%;
  }

  path.slice{
    stroke-width:2px;
  }

  polyline{
    opacity: .3;
    stroke: black;
    stroke-width: 2px;
    fill: none;
  }

</style>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.6.0/d3-legend.min.js"></script>

<script>
  
//https://developers.google.com/youtube/player_parameters?hl=en
    
  var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/player_api";

  var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  var player;

  function onYouTubePlayerAPIReady() {
    player = new YT.Player('ytplayerLanding', {
     /* height: '390',
      width: '640',*/
      videoId: 'k7uuLp5FpJA',
      playerVars: { 
         'showinfo': 0,
         /*'controls': 1,*/
         'autohide':1
        }
      
    });
  }


 function favouriteQueries () {
      var data = [
          {"url":"./api?data=1","text":"Show me data about MUNICIPAL BUDGETS in BELGRADE in 1999 related to EDUCATION"},
          {"url":"./api?data=2","text":"Show me data about MUNICIPAL DONATIONS in NIS in 2010 related to PUBLIC TRANSPORTATIONS"},
          {"url":"./api?data=3","text":"Show me data about MUNICIPAL BUDGETS in NOVI SAD in 2010 related to PUBLIC HEALTH"},
          {"url":"./api?data=4","text":"Show me data about MUNICIPAL EXPANDITURES in PRIJEPOLJE in 2015 related to PROCUREMENT"},
          {"url":"./api?data=5","text":"Show me data about REGIONAL INCOMES in CENTRALNA SRBIJA in 2013 "}
      ];
      var indx = Math.floor(Math.random()*4); 

      return data[indx];

  } 

$(function () {

  $("#anotherFavQuery").click(function () {
          
        var datum = favouriteQueries(); 
        $("#searchWithParams").html(datum.text);
        $("#searchWithParams").parent().attr("href",datum.url);
    })
  

})

$(function(){

  /*http://bl.ocks.org/dbuezas/9306799*/

  var svg = d3.select(".vis")
    .append("svg")
    .append("g")

  svg.append("g")
    .attr("class", "slices");
  svg.append("g")
    .attr("class", "labels");
  svg.append("g")
    .attr("class", "lines");

  var width = 960,
      height = 450,
    radius = Math.min(width, height) / 2;

  var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) {
      return d.value;
    });

  var arc = d3.svg.arc()
    .outerRadius(radius * 0.8)
    .innerRadius(radius * 0.4);

  var outerArc = d3.svg.arc()
    .innerRadius(radius * 0.9)
    .outerRadius(radius * 0.9);

  svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

  var key = function(d){ return d.data.label; };

  /*Conto numbers: 
  Prihodi 710000, poraz na zarade (712000), porez na imovinu (713000), donacije i transferi (730000), transferi od drugih nivoa vlasti (733000).

  Rashodi za zaposlene (410000), troskovi putovanja (422000), donacije, dotacije i transferi (460000), subvencije (450000).*/

  var color = d3.scale.ordinal()
    .domain(["Porez na zarade", "Porez na imovinu", "Donacije i transferi", "Transferi od drugih novoa vlasti", "Troskovi putovanja", "Donacije, dotacije i transferi", "Subvencije"])
    .range(["#feedde","#fdbe85","#fd8d3c","#d94701",  "#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);




var svg1 = d3.select("svg");

svg1.append("g")
  .attr("class", "legendOrdinal")
  .attr("transform", "translate(20,20)");

var legendOrdinal = d3.legend.color()
  .shape("path", d3.svg.symbol().type("circle").size(150)())
  .shapePadding(10)
  .scale(color);

svg1.select(".legendOrdinal")
  .call(legendOrdinal);

function randomData (){
    var labels = color.domain();
    return labels.map(function(label){
      return { label: label, value: Math.random() }
    });
  }

  change(randomData());

  /*d3.select(".randomize")
    .on("click", function(){
      change(randomData());
    });
  */

  function change(data) {

    /* ------- PIE SLICES -------*/
    var slice = svg1.select(".slices").selectAll("path.slice")
      .data(pie(data), key);

    slice.enter()
      .insert("path")
      .style("fill", function(d) { return color(d.data.label); })
      .attr("class", "slice");

    slice   
      .transition().duration(1000)
      .attrTween("d", function(d) {
        this._current = this._current || d;
        var interpolate = d3.interpolate(this._current, d);
        this._current = interpolate(0);
        return function(t) {
          return arc(interpolate(t));
        };
      })

    slice.exit()
      .remove();

    /* ------- TEXT LABELS -------*/

  /*  var text = svg.select(".labels").selectAll("text")
      .data(pie(data), key);

    text.enter()
      .append("text")
      .attr("dy", ".35em")
      .text(function(d) {
        return d.data.label;
      });
    
    function midAngle(d){
      return d.startAngle + (d.endAngle - d.startAngle)/2;
    }

    text.transition().duration(1000)
      .attrTween("transform", function(d) {
        this._current = this._current || d;
        var interpolate = d3.interpolate(this._current, d);
        this._current = interpolate(0);
        return function(t) {
          var d2 = interpolate(t);
          var pos = outerArc.centroid(d2);
          pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
          return "translate("+ pos +")";
        };
      })
      .styleTween("text-anchor", function(d){
        this._current = this._current || d;
        var interpolate = d3.interpolate(this._current, d);
        this._current = interpolate(0);
        return function(t) {
          var d2 = interpolate(t);
          return midAngle(d2) < Math.PI ? "start":"end";
        };
      });

    text.exit()
      .remove();*/

    /* ------- SLICE TO TEXT POLYLINES -------*/

    /*var polyline = svg.select(".lines").selectAll("polyline")
      .data(pie(data), key);
    
    polyline.enter()
      .append("polyline");

    polyline.transition().duration(1000)
      .attrTween("points", function(d){
        this._current = this._current || d;
        var interpolate = d3.interpolate(this._current, d);
        this._current = interpolate(0);
        return function(t) {
          var d2 = interpolate(t);
          var pos = outerArc.centroid(d2);
          pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
          return [arc.centroid(d2), outerArc.centroid(d2), pos];
        };      
      });
    
    polyline.exit()
      .remove();*/
  };



})




</script>

<!-- Intro Header; Welcome section -->
<header class="container-fluid section-height intro landing section-height">
    <div class="intro-body">
        <div>
          <div class="height-110 white-content primary-color">
           <div class="col-md-8 col-md-offset-2 height-110">
            <h3 class="text-center">Welcome</h3>
                     <p class="text-center lead">
                       Welcome to Data Center â€“ an open platform that helps you find, liberate and make use of different public data!
                    </p>
                    </div>
          </div>
            <div class="row overlay-video">
                <div class="col-md-6 col-md-offset-3 negative-margin-5">
                    
                    
                    <div class='embed-container'>
                        <div id="ytplayerLanding"></div>
                    </div>
                    <div class="margin-10"><a href="{{ url_for('api.index') }}"><span id="searchWithParams">Show me data about MUNICIPAL BUDGETS in BELGRADE in 1999 related to EDUCATION</span></a></div>

                    <div class="row">
                        <div class="col-md-6 margin-10">

                        <a href="{{ url_for('api.index') }}">   
                            <button type="button" class="btn btn-block btn-lg  btn-link btn-white-border primary-color white-content " >
                                Just take me to search
                            </button>
                        </a>
                        </div>
                        <div class="col-md-6 margin-10">
                            <button id="anotherFavQuery" type="button" class="btn btn-block btn-lg btn-link btn-white-border primary-color white-content">
                                Meh, what else you got?
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- What's avalible Section -->
<section id="avalibleS" class="container-fluid section-height secondary-color content-section text-center white-content">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2">
            <h2>What's avalible Section</h2>
            <!-- <img class="img-responsive text-center margin-auto" src="https://placeholdit.imgix.net/~text?txtsize=33&txt=800%C3%97400&w=800&h=400" alt=""> -->
            <div class="vis margin-auto">
              bla lba bla
            </div>
        </div>
    </div>
</section>


{% endblock %}
